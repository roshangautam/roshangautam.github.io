{"componentChunkName":"component---src-templates-blog-post-js","path":"/automation-curl-bash/","result":{"data":{"site":{"siteMetadata":{"title":"Reveries of a software engineer"}},"markdownRemark":{"id":"baca6f4e-6e21-5ff6-baac-18a2f40d97fa","excerpt":"Have you ever found yourself in a situation where you want to download a list of videos from an online course to watch them offline and there is no option to…","html":"<p style=\"text-align: center;\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/4e0023ef6379e1029bfcc59b7fe349a6/cab8c/automating-video-downloads.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 53.79746835443038%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACY0lEQVQoz32SzW8SQRjGuWqs9kutH221WmPaulBAKGhivCjx4MWYJkaNxngx8aZ/gzHx4sGD2ppigWW3pS2UBYqY1nAgfsRYdmYoYiANRivLLsvuQqVE14xCNKZwmUzeed9fnuedRxNO5LYFUL6dQfxuHxT2z0LxoAcWj0xBaYAG8jEKyDoaKDqKlfQ0Kw9TUCbwG+6ZhWKfDwrdfiR0BVC+YyHBtWhCiNvOIL5zHgl752Ch1wOL/XiAAjJBAsXgAuvGx8vrpx+83bBNJssGN6sYKSBr69A5WDgwj4R9TILfGULcDk0Q5VsZxO/yod/q+qahdBQrI4Gid4Ky2cEWTz5MrV0jY+kroUXhzLNkxVSDErh3BoqHfLDQjR0GUL5Ngw8/4ru8sNAzA4uHa+q0JFBM46w68iYDbExUvOGIRW++iwXPjadUM8lKZjdQdFNQGsSOvLDQ60fCHrw6DGzHO/D+tTvoBsqw/UPJ4v+yYbzwlH9y8X76q20s8+2s8xNFAtU6ySoW7ICG0lDd9h8g39EYuFyyvMhUDFe98qNLZFY9P5ZVR+k1jz/947g9XrI2AXJtNWDPDBTrlnUuUDI9Z8snItmfpluh8uvr9GqaikunyETF6mBLjS0HEbfpp7iBorfHy5bI6nfibli+c5sR7y1+rhITy1hdydDwU5rGhi0aXSlV64i+Gp1YWrrs/KhqcW3T2KBabMIJrkmwi4QTVgl/fGVk4X3S6oRVLQ2k/4Jd+CfYuRbNy2RuCyYzKN+J94AbatB+bGkaigNuUB2k4tUhfMc1/IZheO94pqauNbLCbf0FWnw83pRKOQYAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"automating video downloads\" title=\"automating video downloads\" src=\"/static/4e0023ef6379e1029bfcc59b7fe349a6/f058b/automating-video-downloads.png\" srcset=\"/static/4e0023ef6379e1029bfcc59b7fe349a6/c26ae/automating-video-downloads.png 158w,\n/static/4e0023ef6379e1029bfcc59b7fe349a6/6bdcf/automating-video-downloads.png 315w,\n/static/4e0023ef6379e1029bfcc59b7fe349a6/f058b/automating-video-downloads.png 630w,\n/static/4e0023ef6379e1029bfcc59b7fe349a6/cab8c/automating-video-downloads.png 744w\" sizes=\"(max-width: 630px) 100vw, 630px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n</p>\n<p>Have you ever found yourself in a situation where you want to download a list of videos from an online course to watch them offline and there is no option to download all the files at once ? Something similar happened to me today while trying to download all the videos from Adam Wathan’s Course Test-Driven Laravel – Build robust applications with TDD Thanks to Adam, he sent me a link to a page where all the videos are listed and has option to download each video either in HD or SD. But the problem was still there. Either I had to click on every link (a total of 142 videos) or use my ability to write code and get this done all at once. And of course I used my programming skills because programmers are lazy and like to create tools which helps them become more lazy. Here are the steps I followed:</p>\n<hr>\n<h2>Create a list of videos</h2>\n<p>The first challenge was to create a list of links to all the videos listed in course page. So this is what I did</p>\n<ul>\n<li>Logged in to my account. This is important as all videos are private and need authentication</li>\n<li>Right clicked and opened the dev tools and inspected one of the HD link tags</li>\n<li>I noticed that HD links can be listed using the text HD links and has a class link-brand. So I ran following JS in dev tools console</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http://a.link-brand\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">el</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">.</span>text <span class=\"token operator\">==</span> <span class=\"token string\">\"Download HD\"</span><span class=\"token punctuation\">)</span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">.</span>href<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>This gave me a list of HD links to all episodes listed in the course. I copied them and pasted them in a file called videos.txt. We will use this file in our next step.</li>\n</ul>\n<h2>Download Videos</h2>\n<p>The next step was to download all videos listed in the file we just created with a single command.</p>\n<ul>\n<li>Just to test I executed a curl command on one of the links to check if it gets redirected to some other URL or not ? and Voila !!! it does get redirected to a different URL and the redirected url has a filename in it. And I thought, I must use the filename while saving the files to my machine to make it easy to know what episode I am on while watching offline.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"sbtshell\"><pre class=\"language-sbtshell\"><code class=\"language-sbtshell\">curl -s -w %{redirect_url} https://link.to.your.episode.net/and/all/id/token/blah/blah</code></pre></div>\n<blockquote>\n<p>If you run this $redirect_url will contain the location of the video with additional params. I quickly wrote a shell script to leverage all this. Here’s the script</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"sbtshell\"><pre class=\"language-sbtshell\"><code class=\"language-sbtshell\">#!/bin/bash\nfilename=&quot;$1&quot;\ncurl=&#39;/usr/bin/curl&#39;\nargs=&quot;-s -w %{redirect_url}&quot;\nwhile read -r url\ndo\n    raw=&quot;$($curl $args $url)&quot;\n    encoded=&quot;$(echo $raw | awk -F&#39;[=&amp;]&#39; &#39;{print $6}&#39;)&quot;\n    name=&quot;$(python -c &quot;import sys, urllib as ul; print ul.unquote_plus(&#39;$encoded&#39;)&quot;)&quot;\n    slug=&quot;$(echo $name | iconv -t ascii//TRANSLIT | sed -E s/[^a-zA-Z0-9.]+/-/g |sed -E s/^-+\\|-+$//g | tr A-Z a-z)&quot;\n    wget -O &quot;$slug&quot; $raw\ndone &lt; &quot;$filename&quot;</code></pre></div>\n<blockquote>\n<p>This script is basically reading a list of urls from an external file ( the one we created in our first step) and then executing curl against each of them one by one and grabbing the redirect url, stripping out the filename query parameter from url, converting the filename into a slug and then finally using wget to save the video with this custom slugged name.</p>\n</blockquote>\n<ul>\n<li>Save the script (videos.sh) along with the file containing the list of videos (videos.txt) and run the following command from your terminal\n<blockquote>\n<p>Make sure you change the permission of your .sh file to 755 and possibly put both files inside a directory. In your terminal navigate to the location of .sh and .txt files created in the steps above</p>\n</blockquote>\n</li>\n</ul>","frontmatter":{"title":"Automation using curl and bash","date":"October 01, 2017","description":"Have you ever found yourself in a situation where you want to download a list of videos from an online course to watch them offline and there is no option to download all the files at once ?","coverImage":"/assets/images/posts/covers/automating-video-downloads.png"}},"previous":{"fields":{"slug":"/laravel-getting-started/"},"frontmatter":{"title":"Getting started with Laravel"}},"next":{"fields":{"slug":"/how-to-create-personal-blog-jigsaw-github-pages/"},"frontmatter":{"title":"How to create a personal blog using Jigsaw and Github Pages"}}},"pageContext":{"id":"baca6f4e-6e21-5ff6-baac-18a2f40d97fa","previousPostId":"05c4ebbb-2fd4-5348-beb0-a6f780d10948","nextPostId":"241d1857-a334-52d1-8e7a-593a08d7e49d"}},"staticQueryHashes":["2114561082","2841359383"]}